<!DOCTYPE html>
<html>
<head>
    <title>Test Mapping-Specific Transformations</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { margin: 5px; padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test Property-Mapping Specific Transformations</h1>
    
    <div class="test-section">
        <h2>Test 1: Create Different Mappings to Same Property</h2>
        <button onclick="runTest1()">Run Test 1</button>
        <div id="test1-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Add Different Transformations</h2>
        <button onclick="runTest2()">Run Test 2</button>
        <div id="test2-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Verify Independence</h2>
        <button onclick="runTest3()">Run Test 3</button>
        <div id="test3-result" class="result"></div>
    </div>

    <script type="module">
        import { createState } from './src/js/state.js';
        import { createTransformationBlock } from './src/js/transformations.js';
        
        const state = createState();
        window.testState = state;
        
        window.runTest1 = function() {
            const result = document.getElementById('test1-result');
            try {
                // Create two different mappings to the same property P1476
                const mapping1Id = state.generateMappingId('dc:title', 'P1476');
                const mapping2Id = state.generateMappingId('schema:name', 'P1476');
                
                result.innerHTML = `
                    <strong>Created Mapping IDs:</strong><br>
                    Mapping 1: ${mapping1Id}<br>
                    Mapping 2: ${mapping2Id}<br>
                    <span class="success">✓ Successfully created unique mapping IDs</span>
                `;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `Error: ${error.message}`;
                result.className = 'result error';
            }
        };
        
        window.runTest2 = function() {
            const result = document.getElementById('test2-result');
            try {
                const mapping1Id = state.generateMappingId('dc:title', 'P1476');
                const mapping2Id = state.generateMappingId('schema:name', 'P1476');
                
                // Add different transformations to each mapping
                const block1 = createTransformationBlock('PREFIX');
                block1.config.text = 'Title: ';
                state.addTransformationBlock(mapping1Id, block1);
                
                const block2 = createTransformationBlock('SUFFIX');
                block2.config.text = ' (from schema)';
                state.addTransformationBlock(mapping2Id, block2);
                
                const blocks1 = state.getTransformationBlocks(mapping1Id);
                const blocks2 = state.getTransformationBlocks(mapping2Id);
                
                result.innerHTML = `
                    <strong>Transformations for dc:title → P1476:</strong><br>
                    ${blocks1.map(b => `- ${b.type}: "${b.config.text}"`).join('<br>')}<br><br>
                    <strong>Transformations for schema:name → P1476:</strong><br>
                    ${blocks2.map(b => `- ${b.type}: "${b.config.text}"`).join('<br>')}<br>
                    <span class="success">✓ Successfully added different transformations</span>
                `;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `Error: ${error.message}`;
                result.className = 'result error';
            }
        };
        
        window.runTest3 = function() {
            const result = document.getElementById('test3-result');
            try {
                const mapping1Id = state.generateMappingId('dc:title', 'P1476');
                const mapping2Id = state.generateMappingId('schema:name', 'P1476');
                
                // Modify one mapping's transformations
                const blocks1Before = state.getTransformationBlocks(mapping1Id);
                const block3 = createTransformationBlock('FIND_REPLACE');
                block3.config.find = 'old';
                block3.config.replace = 'new';
                state.addTransformationBlock(mapping1Id, block3);
                
                const blocks1After = state.getTransformationBlocks(mapping1Id);
                const blocks2After = state.getTransformationBlocks(mapping2Id);
                
                result.innerHTML = `
                    <strong>After adding to dc:title mapping:</strong><br>
                    dc:title blocks: ${blocks1After.length} (was ${blocks1Before.length})<br>
                    schema:name blocks: ${blocks2After.length} (unchanged)<br>
                    <span class="success">✓ Transformations are independent!</span>
                `;
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `Error: ${error.message}`;
                result.className = 'result error';
            }
        };
    </script>
</body>
</html>