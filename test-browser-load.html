<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Load Test</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üåê Browser Load Test</h1>
    <p>Testing if the reconciliation modal redesign loads without import errors...</p>
    
    <div id="test-status" class="status pending">‚è≥ Testing import statements...</div>
    <div id="error-log" class="log" style="display: none;"></div>
    <div id="success-log" class="log" style="display: none;"></div>

    <script type="module">
        const statusDiv = document.getElementById('test-status');
        const errorLog = document.getElementById('error-log');
        const successLog = document.getElementById('success-log');
        
        let errors = [];
        let successes = [];
        
        // Capture console errors
        const originalError = console.error;
        console.error = function(...args) {
            errors.push(args.join(' '));
            errorLog.textContent += args.join(' ') + '\n';
            errorLog.style.display = 'block';
            originalError.apply(console, args);
        };
        
        // Capture console logs
        const originalLog = console.log;
        console.log = function(...args) {
            if (args[0] && args[0].includes && (args[0].includes('imported') || args[0].includes('loaded'))) {
                successes.push(args.join(' '));
                successLog.textContent += args.join(' ') + '\n';
                successLog.style.display = 'block';
            }
            originalLog.apply(console, args);
        };
        
        // Handle uncaught errors
        window.addEventListener('error', (event) => {
            errors.push(`Runtime Error: ${event.message} at ${event.filename}:${event.lineno}`);
            errorLog.textContent += `Runtime Error: ${event.message} at ${event.filename}:${event.lineno}\n`;
            errorLog.style.display = 'block';
        });
        
        async function runTest() {
            try {
                // Test 1: Import reconciliation display functions
                console.log('Testing reconciliation display imports...');
                const reconciliationDisplay = await import('./src/js/reconciliation/ui/reconciliation-display.js');
                
                const requiredFunctions = [
                    'displayReconciliationResults',
                    'displayHighConfidenceMatches', 
                    'displayFallbackOptions',
                    'showCustomInputInterface',
                    'setupManualSearchInFallback',
                    'displayFallbackSearchResults',
                    'setupExpandedSearch'
                ];
                
                let missingFunctions = [];
                requiredFunctions.forEach(func => {
                    if (typeof reconciliationDisplay[func] !== 'function') {
                        missingFunctions.push(func);
                    } else {
                        console.log(`‚úÖ Function ${func} imported successfully`);
                    }
                });
                
                if (missingFunctions.length > 0) {
                    throw new Error(`Missing functions: ${missingFunctions.join(', ')}`);
                }
                
                // Test 2: Import from reconciliation index
                console.log('Testing reconciliation index imports...');
                const reconciliationIndex = await import('./src/js/reconciliation/index.js');
                
                // Test that the new functions are available
                requiredFunctions.forEach(func => {
                    if (typeof reconciliationIndex[func] !== 'function') {
                        missingFunctions.push(`${func} (from index)`);
                    } else {
                        console.log(`‚úÖ Function ${func} exported from index`);
                    }
                });
                
                if (missingFunctions.length > 0) {
                    throw new Error(`Missing exports from index: ${missingFunctions.join(', ')}`);
                }
                
                // Test 3: Import reconciliation modal  
                console.log('Testing reconciliation modal imports...');
                const reconciliationModal = await import('./src/js/reconciliation/ui/reconciliation-modal.js');
                
                if (typeof reconciliationModal.createReconciliationModal !== 'function') {
                    throw new Error('createReconciliationModal not found');
                }
                console.log('‚úÖ Reconciliation modal functions imported successfully');
                
                // Test 4: Import validation engine
                console.log('Testing validation engine imports...');
                const validationEngine = await import('./src/js/reconciliation/ui/validation-engine.js');
                
                if (typeof validationEngine.extractRegexConstraints !== 'function') {
                    throw new Error('extractRegexConstraints not found');
                }
                console.log('‚úÖ Validation engine functions imported successfully');
                
                // Test 5: Try importing steps/reconciliation.js (where the error occurs)
                console.log('Testing steps/reconciliation.js import...');
                
                // This should now work without throwing an import error
                try {
                    const reconciliationStep = await import('./src/js/steps/reconciliation.js');
                    console.log('‚úÖ Steps reconciliation imported successfully');
                } catch (importError) {
                    throw new Error(`Steps import failed: ${importError.message}`);
                }
                
                // If we get here, all tests passed
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ All import tests passed! The browser can load the application without errors.';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå Import test failed: ${error.message}`;
                
                errorLog.textContent += `\nTest Error: ${error.message}\n`;
                errorLog.style.display = 'block';
            }
        }
        
        // Run the test after a short delay
        setTimeout(runTest, 100);
    </script>
</body>
</html>